<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        DBMS Lecture 7-  Transactions: - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i|Source+Code+Pro:300,400,500|Source+Sans+Pro:300,300i,400,400i,600,600i|Source+Serif+Pro&subset=latin-ext);.hljs{background:#fff;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-string,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#0086b3}.hljs-built_in,.hljs-builtin-name{color:#005cc5}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#795da3}.hljs-addition{background-color:#eaffea;color:#55a532}.hljs-deletion{background-color:#ffecec;color:#bd2c00}.hljs-link{text-decoration:underline}.markdown-body{word-wrap:break-word;font-size:16px;line-height:1.5}.markdown-body:after,.markdown-body:before{content:"";display:table}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-bottom:16px;margin-top:0}.markdown-body hr{background-color:#e7e7e7;border:0;height:.25em;margin:24px 0;padding:0}.markdown-body blockquote{border-left:.25em solid #ddd;color:#777;font-size:16px;padding:0 1em}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd,.popover kbd{background-color:#fcfcfc;border:1px solid;border-color:#ccc #ccc #bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb;color:#555;display:inline-block;font-size:11px;line-height:10px;padding:3px 5px;vertical-align:middle}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:600;line-height:1.25;margin-bottom:16px;margin-top:24px}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{border-bottom:1px solid #eee;padding-bottom:.3em}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{color:#777;font-size:.85em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{list-style-type:none;padding:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-bottom:0;margin-top:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{padding-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{font-size:1em;font-style:italic;font-weight:700;margin-top:16px;padding:0}.markdown-body dl dd{margin-bottom:16px;padding:0 16px}.markdown-body table{display:block;overflow:auto;width:100%;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{border:1px solid #ddd;padding:6px 13px}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{background-color:#fff;box-sizing:initial;max-width:100%}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{background-color:initial;max-width:none;vertical-align:text-top}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{border:1px solid #ddd;display:block;float:left;margin:13px 0 0;overflow:hidden;padding:7px;width:auto}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{clear:both;color:#333;display:block;padding:5px 0 0}.markdown-body span.align-center{clear:both;display:block;overflow:hidden}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{clear:both;display:block;overflow:hidden}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{background-color:#0000000a;border-radius:3px;font-size:85%;margin:0;padding:.2em 0}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{content:"\00a0";letter-spacing:-.2em}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{background:#0000;border:0;font-size:100%;margin:0;padding:0;white-space:pre;word-break:normal}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{background-color:#f7f7f7;border-radius:3px;font-size:85%;line-height:1.45;overflow:auto;padding:16px}.markdown-body pre code,.markdown-body pre tt{word-wrap:normal;background-color:initial;border:0;display:inline;line-height:inherit;margin:0;max-width:auto;overflow:visible;padding:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{font-size:12px;line-height:1;overflow:hidden;padding:5px;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{background:#fff;border:0;padding:10px 8px 9px;text-align:right}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{background:#f8f8f8;border-top:0;font-weight:700}.news .alert .markdown-body blockquote{border:0;padding:0 0 0 40px}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{cursor:default!important;float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle}.markdown-body{max-width:758px;overflow:visible!important;padding-bottom:40px;padding-top:40px;position:relative}.markdown-body .emoji{vertical-align:top}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{border-right:3px solid #6ce26c!important;box-sizing:initial;color:#afafaf!important;cursor:default;display:inline-block;min-width:20px;padding:0 8px 0 0;position:relative;text-align:right;z-index:4}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-bottom:none;border-left:none;border-top:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-collapse:inherit!important;border-spacing:0}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{margin-bottom:unset;overflow:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p:last-child{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{background-color:inherit;border-radius:0;overflow:visible;text-align:center;white-space:inherit}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{height:100%;max-width:100%}.markdown-body pre>code.wrap{word-wrap:break-word;white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap}.markdown-body .alert>p:last-child,.markdown-body .alert>ul:last-child{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body .mark,.markdown-body mark{background-color:#fff1a7}.vimeo,.youtube{background-color:#000;background-position:50%;background-repeat:no-repeat;background-size:contain;cursor:pointer;display:table;overflow:hidden;text-align:center}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{object-fit:contain;width:100%;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{height:100%;left:0;position:absolute;top:0;width:100%}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{color:#fff;height:auto;left:50%;opacity:.3;position:absolute;top:50%;transform:translate(-50%,-50%);transition:opacity .2s;width:auto;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.figma{display:table;padding-bottom:56.25%;position:relative;width:100%}.figma iframe{border:1px solid #eee;bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.markmap-container{height:300px}.markmap-container>svg{height:100%;width:100%}.MJX_Assistive_MathML{display:none}#MathJax_Message{z-index:1000!important}.ui-infobar{color:#777;margin:25px auto -25px;max-width:760px;position:relative;z-index:2}.toc .invisable-node{list-style-type:none}.ui-toc{bottom:20px;position:fixed;z-index:998}.ui-toc.both-mode{margin-left:8px}.ui-toc.both-mode .ui-toc-label{border-bottom-left-radius:0;border-top-left-radius:0;height:40px;padding:10px 4px}.ui-toc-label{background-color:#e6e6e6;border:none;color:#868686;transition:opacity .2s}.ui-toc .open .ui-toc-label{color:#fff;opacity:1;transition:opacity .2s}.ui-toc-label:focus{background-color:#ccc;color:#000;opacity:.3}.ui-toc-label:hover{background-color:#ccc;opacity:1;transition:opacity .2s}.ui-toc-dropdown{margin-bottom:20px;margin-top:20px;max-height:70vh;max-width:45vw;overflow:auto;padding-left:10px;padding-right:10px;text-align:inherit;width:25vw}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{letter-spacing:.0029em;padding-right:0}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{color:#767676;display:block;font-size:13px;font-weight:500;padding:4px 20px}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{background-color:initial;border-left:1px solid #000;color:#000;padding-left:19px;text-decoration:none}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{border-left:none;border-right:1px solid #000;padding-right:19px}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{background-color:initial;border-left:2px solid #000;color:#000;font-weight:700;padding-left:18px}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{border-left:none;border-right:2px solid #000;padding-right:18px}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:30px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:40px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{font-weight:500;padding-left:28px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{font-weight:500;padding-left:38px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-tw] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-cn] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html[lang=zh-tw] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html[lang=zh-cn] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}html .ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html .ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html .ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}.ui-affix-toc{max-height:70vh;max-width:15vw;overflow:auto;position:fixed;top:0}.back-to-top,.expand-toggle,.go-to-bottom{color:#999;display:block;font-size:12px;font-weight:500;margin-left:10px;margin-top:10px;padding:4px 10px}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{background-position:50%;background-repeat:no-repeat;background-size:cover;border-radius:50%;display:block;height:20px;margin-bottom:2px;margin-right:5px;margin-top:2px;width:20px}.ui-user-icon.small{display:inline-block;height:18px;margin:0 0 .2em;vertical-align:middle;width:18px}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.ui-more-info{color:#888;cursor:pointer;vertical-align:middle}.ui-more-info .fa{font-size:16px}.ui-connectedGithub,.ui-published-note{color:#888}.ui-connectedGithub{line-height:23px;white-space:nowrap}.ui-connectedGithub a.file-path{color:#888;padding-left:22px;text-decoration:none}.ui-connectedGithub a.file-path:active,.ui-connectedGithub a.file-path:hover{color:#888;text-decoration:underline}.ui-connectedGithub .fa{font-size:20px}.ui-published-note .fa{font-size:20px;vertical-align:top}.unselectable{-webkit-user-select:none;-o-user-select:none;user-select:none}.selectable{-webkit-user-select:text;-o-user-select:text;user-select:text}.inline-spoiler-section{cursor:pointer}.inline-spoiler-section .spoiler-text{background-color:#333;border-radius:2px}.inline-spoiler-section .spoiler-text>*{opacity:0}.inline-spoiler-section .spoiler-img{filter:blur(10px)}.inline-spoiler-section.raw{background-color:#333;border-radius:2px}.inline-spoiler-section.raw>*{opacity:0}.inline-spoiler-section.unveil{cursor:auto}.inline-spoiler-section.unveil .spoiler-text{background-color:#3333331a}.inline-spoiler-section.unveil .spoiler-text>*{opacity:1}.inline-spoiler-section.unveil .spoiler-img{filter:none}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{color:#222;position:relative;z-index:1}.markdown-body.slides:before{background-color:currentColor;bottom:0;box-shadow:0 0 0 50vw;content:"";display:block;left:0;position:absolute;right:0;top:0;z-index:-1}.markdown-body.slides section[data-markdown]{background-color:#fff;margin-bottom:1.5em;position:relative;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{left:1em;max-height:100%;overflow:hidden;position:absolute;right:1em;top:50%;transform:translateY(-50%)}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{border:3px solid #777;content:"";height:1.5em;position:absolute;right:1em;top:-1.5em}.site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}html[lang^=ja] body{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}abbr[data-original-title],abbr[title]{cursor:help}body.modal-open{overflow-y:auto;padding-right:0!important}svg{text-shadow:none}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid comment-enabled" data-hard-breaks="true"><h1 id="DBMS-Lecture-7--Transactions" data-id="DBMS-Lecture-7--Transactions"><a class="anchor hidden-xs" href="#DBMS-Lecture-7--Transactions" title="DBMS-Lecture-7--Transactions"><span class="octicon octicon-link"></span></a><span>DBMS Lecture 7-  Transactions:</span></h1><div class="alert alert-info">
<p><strong><span>Agenda:</span></strong></p>
<ul>
<li><a href="##Introduction-to-Transactions:"><span>Introduction to Transactions:</span></a></li>
<li><a href="##ACID-Properties:"><span>ACID Properties:</span></a>
<ul>
<li><a href="###Atomicity:"><span>Atomicity:</span></a></li>
<li><a href="###Consistency:"><span>Consistency:</span></a></li>
<li><a href="###Isolation:"><span>Isolation:</span></a></li>
<li><a href="###Durability:"><span>Durability:</span></a></li>
</ul>
</li>
<li><a href="##Transaction-Isolation-Levels:"><span>Transaction Isolation Levels:</span></a>
<ul>
<li><a href="###Read-Uncommitted:"><span>Read Uncommitted:</span></a></li>
<li><a href="###Read-Committed:"><span>Read Committed:</span></a></li>
<li><a href="###Repeatable-Read:"><span>Repeatable Read:</span></a></li>
<li><a href="###Serializable:"><span>Serializable:</span></a></li>
</ul>
</li>
<li><a href="##DEADLOCK:"><span>DEADLOCK:</span></a></li>
</ul>
</div><h2 id="Introduction-to-Transactions" data-id="Introduction-to-Transactions"><a class="anchor hidden-xs" href="#Introduction-to-Transactions" title="Introduction-to-Transactions"><span class="octicon octicon-link"></span></a><span>Introduction to Transactions:</span></h2><p><span>Transactions are a set of logically related operations.</span></p><p><span>Let’s understand with the help of a Bank example:</span><br>
<img src="https://i.imgur.com/UkiASFd.png" alt="" loading="lazy"></p><p><span>send money(fromaccount, toaccount, amount)</span><br>
<span>{</span></p><ol>
<li><span>t=get current balance of fromaccount</span></li>
<li><span>t=t-amount.</span></li>
<li><span>Store t in the database.</span></li>
<li><span>t= get current balance of toaccount.</span></li>
<li><span>t=t+amount</span></li>
<li><span>store t in database.</span></li>
</ol><p><span>}</span></p><p><span>So a single operation which is to send money from A to B, it can actually be broken down into multiple operations that happen behind the scenes.</span></p><p><span>Now, Let’s take a scenerio.</span><br>
<span>In above query, we started sending money, got the current balance of fromaccount and store it in the DB(till step 3 it’s done), then got the current balance of toaccount but after this some crash happened.</span><br>
<span>Now basically the money has been lost, which is not a desirable situation.</span></p><p><span>Another Scenerio can be,</span></p><p><span>Both of this is happening at the exact same time.</span><br>
<img src="https://hackmd.io/_uploads/rJIgvu3Ls.png" alt="" loading="lazy"></p><p><span class="ui-comment-inline-span">This is not right, first B has 700000 because of ‘C’ then 200500 because of ‘A’. This is an issue of </span><strong><span class="ui-comment-inline-span">concurrency.</span></strong><br>
<span>When multiple transaction happens at the same data at the exact same time, We have to ensure that they don’t conflict with each other, we have to handle concurrency as well.</span></p><p><strong><span>Therefore, Transactions are nothing but a set of logically related operations which should work together to achieve the outcome.</span></strong></p><hr><h2 id="ACID-Properties" data-id="ACID-Properties"><a class="anchor hidden-xs" href="#ACID-Properties" title="ACID-Properties"><span class="octicon octicon-link"></span></a><span>ACID Properties:</span></h2><p><span>A: Atomicity</span><br>
<span>C: Consistency</span><br>
<span>I: Isolation</span><br>
<span>D: Durability</span></p><h3 id="Atomicity" data-id="Atomicity"><a class="anchor hidden-xs" href="#Atomicity" title="Atomicity"><span class="octicon octicon-link"></span></a><span>Atomicity:</span></h3><p><span>Atom is smallest indivisible particle, smallest unit which cannot be broken further and appears to be a single unit.</span></p><p><strong><span>Atomicity says that Either everything should happen or nothing should happen at all.</span></strong></p><p><span>Transaction internally has multiple operations but as an observant it should appear to be like a single unit.</span><br>
<em><span>For Example:</span></em><span> </span><strong><span>TRANSFER_MONEY</span></strong><span>, it should appear like a single unit.</span></p><p><span>Like there should be not be a case that the transfer_money transaction runs and the money gets deducted from A but is not added in B. In this case observant will feel that internally multiple things are happening that’s why half of the things happened but remaining didn’t happen.</span></p><h3 id="Consistency" data-id="Consistency"><a class="anchor hidden-xs" href="#Consistency" title="Consistency"><span class="octicon octicon-link"></span></a><span>Consistency:</span></h3><p><span>Consistency means a transaction should never leave the Database in an inconsistent state. The system should be consistent before the transaction starts as well as after the transaction ends.</span></p><p><span>Like in bank example, money got deducted from A but not added in B. But in between the transaction, it’s ok if temporarily it is inconsistent.</span></p><p><em><span>Example:</span></em><span> In above case, when the money was deducted from A but didn’t get added to B yet it was an inconsistent state but it is a temporary internal inconsistent state and after the transaction will end it will be consistent again.</span></p><h3 id="Isolation" data-id="Isolation"><a class="anchor hidden-xs" href="#Isolation" title="Isolation"><span class="octicon octicon-link"></span></a><span>Isolation:</span></h3><p><span>There are multiple transactions that are happening on the same data at the same time but other transactions running in the system should not affect a given transaction.</span><br>
<span>Every transaction should be independent and produce desire results.</span></p><p><span>In above example: There was a transaction T1, and the transaction T2 both are working with the shared data B. Both try to change the value of B at the exact same time and because of presence of each other, they ended up producing the wrong result.</span></p><h3 id="Durability" data-id="Durability"><a class="anchor hidden-xs" href="#Durability" title="Durability"><span class="octicon octicon-link"></span></a><span>Durability:</span></h3><p><span>Durability says, After a transaction has ended, it’s result should persist. The change should persist even in case of hardware failures</span><span class="ui-comment-inline-span">. i.e. it should be persisted to the disk</span><span>.</span></p><p><span>For Example: If A sent money to B but after 2 days they check their balance and it’s gone. It should not be the case.</span></p><div class="alert alert-info">
<p><span>A-&gt; Everything should run or nothing should run.</span><br>
<span>C-&gt; Consistent before and after the transaction.</span><br>
<span>I-&gt; Not affected by other transactions.</span><br>
<span>D-&gt; Once transaction is succeeded, no data loss should happen.</span></p>
</div><p><span>In practice, a transaction can be considered to involve 2 types of operations:</span></p><ol>
<li><span>Read</span></li>
<li><span>Write</span></li>
</ol><p><span>We have discussed 4 operations: CRUD,</span><br>
<span>C-&gt; Write</span><br>
<span>R-&gt; Read</span><br>
<span>U-&gt; Write</span><br>
<span>D-&gt; Write</span></p><p><strong><span>Transaction for bank money transfer.</span></strong></p><p><strong><span>A-&gt; B (x amount of money).</span></strong></p><ol>
<li><span>t=Read(A)</span></li>
<li><span>t-=x</span></li>
<li><span>Write(A,t)</span></li>
<li><span>t=Read(B)</span></li>
<li><span>t+=x</span></li>
<li><span>Write(B,t)</span></li>
</ol><hr><p><span>Now, </span><strong><span>Failures and Durability are handled by 2 operations:</span></strong></p><ol>
<li><span>Commit: Transaction has executed successfully and the results are going to persist.</span></li>
<li><span>RollBack: Undo all the operations that happened in the Database till that time.</span></li>
</ol><p><span>After all the operations of transaction are executed, once the database is sure that everything is completed, it will execute last final command: </span><strong><span>COMMIT</span></strong><span>.</span><br>
<span>Once committed, we cannot reverse the changes.</span><br>
<span>Whatever has happened in transaction till now, store it.</span></p><p><span>But if we are in a non-desirable state(when we cannot proceed ahead with the transaction) we execute the </span><strong><span>ROLLBACK</span></strong><span> statement.</span></p><p><span>Let us consider an example from our shared sample databases in the mysql workbench:</span><br>
<span>Let’s take products table,</span><br>
<img src="https://hackmd.io/_uploads/r1GnM0jri.png" alt="" loading="lazy"></p><p><span>In 1 transaction I have to increase the value of id=1 by 10 and decrease product with id=8 by 10</span></p><p><span class="ui-comment-inline-span">Consider the following set of queries</span><br>
<code>start transaction;</code></p><pre><code>1.update products 
set quantity_in_stock=80
where product_id=1;
</code></pre><pre><code>2.update products 
set quantity_in_stock=16
where product_id=8;
</code></pre><p><code>commit;</code></p><p><span>Run1</span></p><ol>
<li><span>Start transaction</span></li>
<li><span>Execute first update.</span></li>
<li><span>Close the query file.</span></li>
<li><span>Reopen and do select.</span></li>
<li><span>No changes, because transaction wasn’t committed.</span></li>
</ol><p><span>Run2.</span></p><ol>
<li><span>Start the transaction.</span></li>
<li><span>Execute second update statement.</span></li>
<li><span>Close the session.</span></li>
<li><span>Reopen and do Select.</span></li>
<li><span>Changes persist this time, because Commit meansw Durability.</span></li>
</ol><p><span class="ui-comment-inline-span">Now again Consider the following set of instructions</span><span>:</span><br>
<code>start transaction;</code></p><pre><code>update sql_inventory.products 
set quantity_in_stock=80
where product_id=1;
</code></pre><p><code>rollback;</code></p><pre><code>update sql_inventory.products 
set quantity_in_stock=16
where product_id=8;
</code></pre><p><code>commit;</code></p><p><span>Here we start the transaction, update the first statement then rollback which brings the database to the last committed state.</span></p><hr><p><span>Now Let’s understand </span><strong><span>How transactions handle concurrency:</span></strong></p><h2 id="Transaction-Isolation-Levels" data-id="Transaction-Isolation-Levels"><a class="anchor hidden-xs" href="#Transaction-Isolation-Levels" title="Transaction-Isolation-Levels"><span class="octicon octicon-link"></span></a><span>Transaction Isolation Levels:</span></h2><p><span>There are 4 levels.</span></p><ol>
<li><span>Read Uncommitted.</span></li>
<li><span>Read committed.</span></li>
<li><span>Repeatable read</span></li>
<li><span>Serializable.</span></li>
</ol><p><span class="ui-comment-inline-span">They are increasingly more strict</span><span>.</span></p><hr><h3 id="Read-Uncommitted" data-id="Read-Uncommitted"><a class="anchor hidden-xs" href="#Read-Uncommitted" title="Read-Uncommitted"><span class="octicon octicon-link"></span></a><span>Read </span><span class="ui-comment-inline-span">Uncommitted</span><span>:</span></h3><p><span>For this transaction level, concurrent transactions read data that is not committed yet.</span></p><p><img src="https://hackmd.io/_uploads/rJFKSE7Io.png" alt="" loading="lazy"></p><p><span>Here both the transactions are running parallely on the same data</span><span class="ui-comment-inline-span">.</span><br>
<span>T1 wants to increase X by 500. T2 wants to update it to 1000. Both are running in parallel.</span></p><p><span>T2 hasn’t committed.</span><br>
<span>In the database, the desired number should be 2500. But it is 1500, so it is not the good situation to be in.</span></p><p><span>The issue happened because we read the data that was not yet committed which can rollback in future.</span><br>
<span>This is called </span><strong><span>Dirty read</span></strong><span>:When you read uncommitted data, and do operations on that.</span></p><p><span>But some Dirty reads are ok as well, it depends on the use case.</span><br>
<span>Example: In facebook news read, Facebook is creating a news feed for the user but it has not committed the news feed yet. It will not affect user much if the post is committed or not. It depends upon use case.</span><br>
<strong><span>If the isolation level of the database </span><span class="ui-comment-inline-span">is</span><span> Read Uncommitted, that means It allow other transaction to read uncommitted data also.</span></strong></p><hr><h3 id="Read-Committed" data-id="Read-Committed"><a class="anchor hidden-xs" href="#Read-Committed" title="Read-Committed"><span class="octicon octicon-link"></span></a><span>Read Committed:</span></h3><p><span>The transaction will only read committed data.</span><br>
<span>Read Committed isolation level safegaurd us against Dirty Reads.</span><br>
<img src="https://i.imgur.com/Ti7W1qv.png" alt="" loading="lazy"></p><p><span>Now, Let’s look into this scenerio.</span><br>
<img src="https://i.imgur.com/TJS6VQ7.png" alt="" loading="lazy"><br>
<span>Now, the final value of x is 1000. That’s kind of a weird situation, </span><span class="ui-comment-inline-span">because T1’s changes are lost.</span></p><ul>
<li><span>This is known as </span><strong><span>LOST UPDATE</span></strong><span>.</span></li>
</ul><p><span>Within the transaction, user just read the value of x twice. This is also not the good situation to be in.</span><br>
<img src="https://i.imgur.com/eduylg0.png" alt="" loading="lazy"></p><p><span>Let’s take an example: Scaler wants to send every student a coupon code.</span><br>
<span>Now let’s take a case that one student get added in between and because of that scaler will have 1 less coupon code now.</span><br>
<img src="https://i.imgur.com/ZigbDfP.png" alt="" loading="lazy"></p><p><span>So this is a problem, scaler have not given coupon code to the new student.</span><br>
<span>This is called </span><strong><span>Non Repeating Reads.</span></strong></p><hr><h3 id="Repeatable-Read" data-id="Repeatable-Read"><a class="anchor hidden-xs" href="#Repeatable-Read" title="Repeatable-Read"><span class="octicon octicon-link"></span></a><span>Repeatable Read:</span></h3><p><span class="ui-comment-inline-span">Within a transaction if a user try to read a value again, it will be same as </span><span class="ui-comment-inline-span"><span class="ui-comment-inline-span">earlier</span></span><span class="ui-comment-inline-span">.</span><br>
<span>It will solve the problem of non-repeatable reads.</span><br>
<img src="https://hackmd.io/_uploads/S1IGyY2Io.png" alt="" loading="lazy"></p><p><span class="ui-comment-inline-span">This is default isolation level in MYSQL.</span></p><hr><h3 id="Serializable" data-id="Serializable"><a class="anchor hidden-xs" href="#Serializable" title="Serializable"><span class="octicon octicon-link"></span></a><span>Serializable:</span></h3><p><span>Let’s understand with the help of a </span><strong><span>Bank Scenerio:</span></strong><br>
<span>If there are 2 people who want to work on this example,</span></p><p><span>Now, whosoever commit first or second, final value is still going to be wrong.</span><br>
<img src="https://i.imgur.com/iraWngU.png" alt="" loading="lazy"><br>
<span>So in the case of bank, the only way to solve is to have no concurrency at all. Both of these transactions should happen in sequential manner.</span><br>
<span>It uses locks behind the scene.If one transaction has taken a lock over a database row, no other transaction will be allowed to even read that row.</span><br>
<span>Each of the other transactions will have to wait till the transaction which has lock completes it’s operation.</span></p><p><span>Now as locks are involved, system will be slower.</span><br>
<span>Therefore, Most of the bank transactions take time, bookmyshow again is slower.</span></p><p><span>Consider the following two queries in separate SQL sessions</span><span class="ui-comment-inline-span"> i</span><span>n workbench</span></p><p><span>In session1:</span></p><p><code>start transaction;</code></p><pre><code>update sql_inventory.products 
set quantity_in_stock=15
where product_id=8;
</code></pre><p><code>commit;</code></p><p><span>In session2:</span></p><p><code>start transaction;</code></p><pre><code>select *
from sql_inventory.products
where product_id=8;
</code></pre><p><code>commit;</code></p><p><strong><span>Steps:</span></strong><br>
<strong><span>1.</span></strong><span> Start both the transactions.</span><br>
<strong><span>2.</span></strong><span> Do update in first transaction</span><br>
<strong><span>3.</span></strong><span> Do select in second transaction. The answer will depend on isolation level of second transaction.</span><br>
<strong><span>3.1</span></strong><span> For </span><strong><span>repeatable read.</span></strong><br>
<span>User can still see quantity_in_stock=16(earlier value) because Within a transaction if a user try to read a value again, it will be same as earlier.</span><br>
<strong><span>3.2</span></strong><span> For </span><strong><span>uncommitted.</span></strong><br>
<span>User will read quantity_in_stock=15(updated one) because In uncommitted level transactions read data that is not committed yet.</span><br>
<strong><span>3.3</span></strong><span> For </span><strong><span>committed.</span></strong><br>
<span>Now, User can see quantity_in_stock=15(updated one) because Committed data means Durability, the changes will persist.</span><br>
<strong><span>3.4</span></strong><span> Explain loader for </span><strong><span>serializable.</span></strong><br>
<span>Here when the user start the transaction and try to read the value in session2, he will see a loader because someone else is working  on product_id=8.</span><br>
<span>There is a default time out of approx 30 sec after that that the user will see an error.</span><br>
<span>As soon as session1 commits, loader goes out.</span></p><p><strong><span>How Serializable works:</span></strong></p><ol>
<li><span>If another transaction has updated the row, no other transaction is allowed to even read the row.</span></li>
</ol><p><span>If the other person has only read the value, then it will work.</span></p><p><img src="https://i.imgur.com/gCB81KZ.png" alt="" loading="lazy"><br>
<span>Now, Read doesn’t take a lock.</span><br>
<span>So even though it’s working it’s not going to give the correct answer.</span></p><p><span class="ui-comment-inline-span">We can take a lock on read also by using “for update”</span><span>.</span><br>
<span>FOR UPDATE.</span></p><pre><code>select *
from accounts
where name='B'
for update; 
</code></pre><p><span>Whatever the user is reading, he will be going to use this value to update on this row later.</span><br>
<img src="https://i.imgur.com/WbBCd3R.png" alt="" loading="lazy"></p><p><span>Lock is taken by:</span></p><ol>
<li><span>Write</span></li>
<li><span>Read for update.</span></li>
</ol><p><span>Let us go back to money transfer and solve that. Use transaction isolation level read s</span><span class="ui-comment-inline-span">erializable and use the following steps</span><span>.</span></p><p><span>Send money(A,B amount)</span></p><ol>
<li><span>Read(A) for update</span></li>
<li><span>Read(B) for update</span><br>
<span>So first take the lock over all the entities that we are going to work with and after that perform the actions.</span></li>
</ol><p><span>x=Read(A) for update</span><br>
<span>y=Read(B) for update</span><br>
<span>x-=amount</span><br>
<span>y+=amount</span><br>
<span>update(A,x)</span><br>
<span>update(B,y)</span></p><hr><h2 id="DEADLOCK" data-id="DEADLOCK"><a class="anchor hidden-xs" href="#DEADLOCK" title="DEADLOCK"><span class="octicon octicon-link"></span></a><span>DEADLOCK:</span></h2><p><img src="https://i.imgur.com/crBmYxH.png" alt="" loading="lazy"></p><p><span>When the system can’t proceed ahead because transactions have lock needed by each other.</span></p><p><span>MySQL automatically detects a deadlock and ROLLBACK  one </span><span class="ui-comment-inline-span">of the transaction</span><span>.</span></p><p><span>Consider the following que</span><span class="ui-comment-inline-span">ries in session2:</span></p><p><code>start transaction;</code></p><pre><code>select *
from sql_inventory.products
where product_id=8
for update;
</code></pre><pre><code>select *
from sql_inventory.products
where product_id=7
for update;
</code></pre><p><code>commit;</code></p><p><span>Consider the following queries </span><span class="ui-comment-inline-span">in session1,</span></p><p><code>start transaction;</code></p><pre><code>select *
from sql_inventory.products
where product_id=7;
</code></pre><pre><code>select *
from sql_inventory.products
where product_id=8;
</code></pre><p><code>commit;</code></p><p><strong><span>Steps:</span></strong></p><ol>
<li><span>Start both transactions</span></li>
<li><span>Run first select in session2.</span></li>
<li><span>Run first select in session1.</span></li>
<li><span>Run second select in session2.</span></li>
<li><span>Run second select in session1. Deadlock will be detected, and one transaction will be rolled back.</span><br>
<span class="ui-comment-inline-span">This is how MYSQL avoid Deadlock from happening.</span></li>
</ol><hr><hr></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li><a href="#DBMS-Lecture-7--Transactions" title="DBMS Lecture 7-  Transactions:">DBMS Lecture 7-  Transactions:</a><ul class="nav">
<li><a href="#Introduction-to-Transactions" title="Introduction to Transactions:">Introduction to Transactions:</a></li>
<li><a href="#ACID-Properties" title="ACID Properties:">ACID Properties:</a><ul class="nav">
<li><a href="#Atomicity" title="Atomicity:">Atomicity:</a></li>
<li><a href="#Consistency" title="Consistency:">Consistency:</a></li>
<li><a href="#Isolation" title="Isolation:">Isolation:</a></li>
<li><a href="#Durability" title="Durability:">Durability:</a></li>
</ul>
</li>
<li><a href="#Transaction-Isolation-Levels" title="Transaction Isolation Levels:">Transaction Isolation Levels:</a><ul class="nav">
<li><a href="#Read-Uncommitted" title="Read Uncommitted:">Read Uncommitted:</a></li>
<li><a href="#Read-Committed" title="Read Committed:">Read Committed:</a></li>
<li><a href="#Repeatable-Read" title="Repeatable Read:">Repeatable Read:</a></li>
<li><a href="#Serializable" title="Serializable:">Serializable:</a></li>
</ul>
</li>
<li><a href="#DEADLOCK" title="DEADLOCK:">DEADLOCK:</a></li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;" null null>
        <div class="toc"><ul class="nav">
<li><a href="#DBMS-Lecture-7--Transactions" title="DBMS Lecture 7-  Transactions:">DBMS Lecture 7-  Transactions:</a><ul class="nav">
<li><a href="#Introduction-to-Transactions" title="Introduction to Transactions:">Introduction to Transactions:</a></li>
<li><a href="#ACID-Properties" title="ACID Properties:">ACID Properties:</a><ul class="nav">
<li><a href="#Atomicity" title="Atomicity:">Atomicity:</a></li>
<li><a href="#Consistency" title="Consistency:">Consistency:</a></li>
<li><a href="#Isolation" title="Isolation:">Isolation:</a></li>
<li><a href="#Durability" title="Durability:">Durability:</a></li>
</ul>
</li>
<li><a href="#Transaction-Isolation-Levels" title="Transaction Isolation Levels:">Transaction Isolation Levels:</a><ul class="nav">
<li><a href="#Read-Uncommitted" title="Read Uncommitted:">Read Uncommitted:</a></li>
<li><a href="#Read-Committed" title="Read Committed:">Read Committed:</a></li>
<li><a href="#Repeatable-Read" title="Repeatable Read:">Repeatable Read:</a></li>
<li><a href="#Serializable" title="Serializable:">Serializable:</a></li>
</ul>
</li>
<li><a href="#DEADLOCK" title="DEADLOCK:">DEADLOCK:</a></li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
